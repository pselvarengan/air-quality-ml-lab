<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå§Ô∏è Virtual Lab: Air Quality Prediction</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
            position: relative;
        }
        
        header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 30%;
            width: 40%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 300;
        }
        
        .time-badge {
            display: inline-block;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            padding: 8px 25px;
            border-radius: 30px;
            font-weight: 600;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .lab-step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 6px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .lab-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .lab-step:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .step-title {
            font-size: 1.4rem;
            color: #2c3e50;
            flex-grow: 1;
            margin-left: 20px;
            font-weight: 600;
        }
        
        .step-time {
            color: #7f8c8d;
            font-weight: 600;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .dataset-table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #eaeaea;
        }
        
        .dataset-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .dataset-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .dataset-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }
        
        .dataset-table tr:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        }
        
        .unit-badge {
            display: inline-block;
            background: #e8f4fc;
            color: #3498db;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
            border: 1px solid #3498db;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        
        .control-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid #eaeaea;
            transition: transform 0.3s ease;
        }
        
        .control-card:hover {
            transform: translateY(-5px);
        }
        
        .control-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-card h3 i {
            color: #667eea;
            font-size: 1.2rem;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
            transform: scale(1.01);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .upload-desc {
            color: #7f8c8d;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .preprocessing-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .checkbox-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #eaeaea;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .checkbox-card:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .checkbox-card input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
        }
        
        .checkbox-label {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .checkbox-desc {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .model-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .model-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-top: 5px solid #667eea;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .model-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .model-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .model-card h4 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .model-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .linear-icon { background: #3498db; }
        .rf-icon { background: #2ecc71; }
        .dt-icon { background: #e74c3c; }
        .svr-icon { background: #9b59b6; }
        
        .model-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .stat-card:hover {
            border-color: #667eea;
            background: white;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .best-model {
            border-top-color: #2ecc71;
            box-shadow: 0 15px 35px rgba(46, 204, 113, 0.2);
        }
        
        .best-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #2ecc71;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .slider-label span:first-child {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .slider-label span:last-child {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1rem;
        }
        
        input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .feature-unit {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
            margin-left: 5px;
        }
        
        button {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.6);
        }
        
        .btn-tertiary {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .btn-tertiary:hover {
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.6);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }
        
        .result-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        
        .result-box h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-box h3 i {
            color: #667eea;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin: 25px 0;
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid #eaeaea;
        }
        
        .prediction-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }
        
        .prediction-input {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid #eaeaea;
        }
        
        .prediction-output {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }
        
        .prediction-value {
            font-size: 4rem;
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .prediction-label {
            font-size: 1.2rem;
            font-weight: 500;
            opacity: 0.9;
        }
        
        .pm25-indicator {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            margin: 20px 0;
            text-align: center;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .good { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .moderate { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .unhealthy { background: linear-gradient(135deg, #e67e22, #d35400); }
        .very-unhealthy { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .hazardous { background: linear-gradient(135deg, #8e44ad, #9b59b6); }
        
        .interpretation-box {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(243, 156, 18, 0.1));
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid #f1c40f;
            box-shadow: 0 15px 40px rgba(0,0,0,0.05);
        }
        
        .interpretation-box h3 {
            color: #d35400;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .data-info {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        .data-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
            padding: 10px 0;
            border-bottom: 1px solid rgba(52, 152, 219, 0.1);
        }
        
        .data-info-item:last-child {
            border-bottom: none;
        }
        
        .progress-container {
            width: 100%;
            background: #ecf0f1;
            border-radius: 10px;
            margin: 15px 0;
            height: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }
        
        .developer-credit {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid rgba(102, 126, 234, 0.3);
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 700;
            position: relative;
        }
        
        .developer-credit::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 30%;
            width: 40%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 350px;
        }
        
        .notification {
            padding: 20px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .notification.success {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.9), rgba(46, 204, 113, 0.9));
        }
        
        .notification.error {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.9), rgba(192, 57, 43, 0.9));
        }
        
        .notification.info {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.9), rgba(41, 128, 185, 0.9));
        }
        
        .notification.warning {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.9), rgba(243, 156, 18, 0.9));
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @media (max-width: 992px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls-grid, .model-comparison, .prediction-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .dataset-table {
                font-size: 0.85rem;
            }
            
            .dataset-table th, .dataset-table td {
                padding: 10px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .lab-step {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        
        /* Feature Cards */
        .feature-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 10px 0;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .feature-card:hover {
            border-color: #667eea;
            background: white;
            transform: translateX(5px);
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .temp-icon { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .humidity-icon { background: linear-gradient(135deg, #3498db, #2980b9); }
        .pressure-icon { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .wind-icon { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .pm25-icon { background: linear-gradient(135deg, #34495e, #2c3e50); }
        
        .feature-info {
            flex-grow: 1;
        }
        
        .feature-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .feature-unit {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .feature-range {
            font-size: 0.8rem;
            color: #95a5a6;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            border-radius: 10px;
            padding: 15px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: 400;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-wind"></i> Virtual Lab: Air Quality Prediction</h1>
            <div class="subtitle">Train ML models to predict PM2.5 levels using environmental factors</div>
            <div class="time-badge"><i class="fas fa-clock"></i> Estimated Time: 2 Hours</div>
        </header>
        
        <!-- Step 1: Introduction -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">Introduction & Objective</div>
                <div class="step-time"><i class="fas fa-clock"></i> 10 min</div>
            </div>
            <p>Welcome to the virtual lab! In this experiment, you will:</p>
            <ul style="margin: 15px 0 15px 25px;">
                <li>Upload and explore air quality datasets in CSV format</li>
                <li>Preprocess data (handle missing values, normalize features)</li>
                <li>Train multiple ML models (Linear Regression, Random Forest)</li>
                <li>Evaluate models using cross-validation, R¬≤ score, and RMSE</li>
                <li>Compare models and make predictions with the best one</li>
            </ul>
            <div class="data-info">
                <h4><i class="fas fa-info-circle"></i> Dataset Requirements</h4>
                <p>Your CSV should include these columns with proper units:</p>
                <div class="feature-card">
                    <div class="feature-icon pm25-icon">
                        <i class="fas fa-smog"></i>
                    </div>
                    <div class="feature-info">
                        <div class="feature-name">PM2.5 <span class="unit-badge">¬µg/m¬≥</span></div>
                        <div class="feature-unit">Fine particulate matter (target variable)</div>
                        <div class="feature-range">Typical range: 0-500 ¬µg/m¬≥</div>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon temp-icon">
                        <i class="fas fa-thermometer-half"></i>
                    </div>
                    <div class="feature-info">
                        <div class="feature-name">Temperature <span class="unit-badge">¬∞C</span></div>
                        <div class="feature-unit">Air temperature in Celsius</div>
                        <div class="feature-range">Typical range: -20 to 45¬∞C</div>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon humidity-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="feature-info">
                        <div class="feature-name">Humidity <span class="unit-badge">%</span></div>
                        <div class="feature-unit">Relative humidity percentage</div>
                        <div class="feature-range">Range: 0-100%</div>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon pressure-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="feature-info">
                        <div class="feature-name">Pressure <span class="unit-badge">hPa</span></div>
                        <div class="feature-unit">Atmospheric pressure in hectopascals</div>
                        <div class="feature-range">Typical range: 950-1050 hPa</div>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon wind-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    <div class="feature-info">
                        <div class="feature-name">Wind Speed <span class="unit-badge">m/s</span></div>
                        <div class="feature-unit">Wind speed in meters per second</div>
                        <div class="feature-range">Typical range: 0-20 m/s</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Step 2: Upload & Explore Dataset -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">Upload & Explore Dataset</div>
                <div class="step-time"><i class="fas fa-clock"></i> 20 min</div>
            </div>
            
            <div class="button-group">
                <button class="btn-secondary" onclick="loadSampleDataset()">
                    <i class="fas fa-database"></i> Load Sample Dataset
                </button>
                <button onclick="downloadSampleCSV()">
                    <i class="fas fa-download"></i> Download Sample CSV Template
                </button>
            </div>
            
            <div class="upload-area" onclick="document.getElementById('csvUpload').click()">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">Upload Your Air Quality CSV File</div>
                <div class="upload-desc">
                    Click here or drag and drop your dataset. Ensure columns include: 
                    PM2.5 (¬µg/m¬≥), temperature (¬∞C), humidity (%), pressure (hPa), wind_speed (m/s)
                </div>
                <input type="file" id="csvUpload" accept=".csv" onchange="handleCSVUpload(event)">
            </div>
            
            <div id="dataInfo" class="data-info" style="display: none;">
                <h4><i class="fas fa-chart-bar"></i> Dataset Information</h4>
                <div class="data-info-item">
                    <span><i class="fas fa-table"></i> Total Rows:</span>
                    <span id="rowCount" class="stat-value">0</span>
                </div>
                <div class="data-info-item">
                    <span><i class="fas fa-columns"></i> Features:</span>
                    <span id="colCount" class="stat-value">0</span>
                </div>
                <div class="data-info-item">
                    <span><i class="fas fa-bullseye"></i> Target Variable:</span>
                    <span id="targetVar" class="stat-value">PM2.5</span>
                </div>
                <div class="data-info-item">
                    <span><i class="fas fa-exclamation-triangle"></i> Missing Values:</span>
                    <span id="missingValues" class="stat-value">0</span>
                </div>
            </div>
            
            <div id="dataPreview" style="display: none;">
                <h4><i class="fas fa-eye"></i> Data Preview (First 10 rows)</h4>
                <div class="dataset-table-container">
                    <table class="dataset-table" id="datasetTable">
                        <thead id="datasetHead"></thead>
                        <tbody id="datasetBody"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="preprocessingSection" style="display: none;">
                <h4><i class="fas fa-cogs"></i> Data Preprocessing Options</h4>
                <div class="preprocessing-options">
                    <div class="checkbox-card">
                        <input type="checkbox" id="removeMissing" checked>
                        <div>
                            <div class="checkbox-label">Remove rows with missing values</div>
                            <div class="checkbox-desc">Eliminates incomplete data points</div>
                        </div>
                    </div>
                    <div class="checkbox-card">
                        <input type="checkbox" id="normalizeData" checked>
                        <div>
                            <div class="checkbox-label">Normalize numerical features (0-1 scaling)</div>
                            <div class="checkbox-desc">Scales all features to 0-1 range for better model performance</div>
                        </div>
                    </div>
                    <div class="checkbox-card">
                        <input type="checkbox" id="removeOutliers">
                        <div>
                            <div class="checkbox-label">Remove outliers (beyond 3 standard deviations)</div>
                            <div class="checkbox-desc">Removes extreme values that could skew results</div>
                        </div>
                    </div>
                    <div class="checkbox-card">
                        <input type="checkbox" id="logTransform" onclick="toggleLogTransform()">
                        <div>
                            <div class="checkbox-label">Apply log transformation to PM2.5</div>
                            <div class="checkbox-desc">Useful when PM2.5 distribution is skewed</div>
                        </div>
                    </div>
                </div>
                
                <div id="featureSelection" style="margin-top: 25px;">
                    <h4><i class="fas fa-sliders-h"></i> Feature Selection</h4>
                    <div style="margin: 15px 0;">
                        <label for="targetSelect" style="font-weight: 600; margin-right: 10px;">Target Variable:</label>
                        <select id="targetSelect" onchange="updateFeatureSelection()" style="padding: 10px 15px; border-radius: 8px; border: 2px solid #667eea; background: white; font-weight: 500;">
                            <option value="PM2_5">PM2.5 (¬µg/m¬≥)</option>
                        </select>
                    </div>
                    
                    <h5 style="margin: 20px 0 15px 0; color: #2c3e50;">Select Features for Model Training</h5>
                    <div id="featureCheckboxes" class="preprocessing-options"></div>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="applyPreprocessing()">
                        <i class="fas fa-play"></i> Apply Preprocessing
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Step 3: Visualize Relationships -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">Visualize Data Relationships</div>
                <div class="step-time"><i class="fas fa-clock"></i> 15 min</div>
            </div>
            <p>Explore correlations between features and the target variable (PM2.5).</p>
            
            <div class="controls-grid">
                <div class="control-card">
                    <h3><i class="fas fa-chart-scatter"></i> Feature vs Target</h3>
                    <div class="chart-container">
                        <canvas id="featureChart"></canvas>
                    </div>
                    <div class="slider-container">
                        <label for="featureSelect" style="font-weight: 600; margin-bottom: 10px; display: block;">Select Feature:</label>
                        <select id="featureSelect" onchange="updateFeatureChart()" style="width: 100%; padding: 12px 15px; border-radius: 10px; border: 2px solid #667eea; background: white; font-weight: 500;">
                            <option value="temperature">Temperature (¬∞C)</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-card">
                    <h3><i class="fas fa-fire"></i> Correlation Heatmap</h3>
                    <div class="chart-container">
                        <canvas id="correlationChart"></canvas>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: #2c3e50;">Interpretation Guide:</span>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: #27ae60; border-radius: 3px;"></div>
                                <span style="font-size: 0.85rem;">Strong positive (>0.7)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: #2ecc71; border-radius: 3px;"></div>
                                <span style="font-size: 0.85rem;">Moderate positive (0.3-0.7)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: #f1c40f; border-radius: 3px;"></div>
                                <span style="font-size: 0.85rem;">Weak (-0.3 to 0.3)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: #e67e22; border-radius: 3px;"></div>
                                <span style="font-size: 0.85rem;">Moderate negative</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 15px; height: 15px; background: #e74c3c; border-radius: 3px;"></div>
                                <span style="font-size: 0.85rem;">Strong negative (<-0.7)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Step 4: Train & Compare Models -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-title">Train, Test & Compare Models</div>
                <div class="step-time"><i class="fas fa-clock"></i> 25 min</div>
            </div>
            
            <div class="controls-grid">
                <div class="control-card">
                    <h3><i class="fas fa-cog"></i> Test Configuration</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span><i class="fas fa-code-branch"></i> Train-Test Split:</span>
                            <span id="splitValue">80%</span>
                        </div>
                        <input type="range" id="trainSplit" min="50" max="90" step="5" value="80" oninput="updateSplitValue()">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.85rem; color: #7f8c8d;">50% Train</span>
                            <span style="font-size: 0.85rem; color: #7f8c8d;">90% Train</span>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <label for="cvFolds" style="font-weight: 600; display: block; margin-bottom: 10px;">
                            <i class="fas fa-project-diagram"></i> Cross-Validation Folds:
                        </label>
                        <select id="cvFolds" style="width: 100%; padding: 12px 15px; border-radius: 10px; border: 2px solid #667eea; background: white; font-weight: 500;">
                            <option value="3">3-fold CV (Fastest)</option>
                            <option value="5" selected>5-fold CV (Recommended)</option>
                            <option value="10">10-fold CV (Most Accurate)</option>
                        </select>
                    </div>
                    
                    <div class="button-group" style="justify-content: center;">
                        <button onclick="runAllModels()" class="pulse">
                            <i class="fas fa-play-circle"></i> Train & Compare All Models
                        </button>
                    </div>
                </div>
                
                <div class="control-card">
                    <h3><i class="fas fa-robot"></i> Model Selection</h3>
                    <div style="margin: 15px 0;">
                        <div class="checkbox-card">
                            <input type="checkbox" id="modelLinear" checked>
                            <div>
                                <div class="checkbox-label">Linear Regression</div>
                                <div class="checkbox-desc">Simple, interpretable, assumes linear relationships</div>
                            </div>
                        </div>
                        <div class="checkbox-card">
                            <input type="checkbox" id="modelRandomForest" checked>
                            <div>
                                <div class="checkbox-label">Random Forest</div>
                                <div class="checkbox-desc">Powerful, handles non-linear relationships, ensemble method</div>
                            </div>
                        </div>
                        <div class="checkbox-card">
                            <input type="checkbox" id="modelDecisionTree">
                            <div>
                                <div class="checkbox-label">Decision Tree</div>
                                <div class="checkbox-desc">Simple tree structure, easy to interpret</div>
                            </div>
                        </div>
                        <div class="checkbox-card">
                            <input type="checkbox" id="modelSVR">
                            <div>
                                <div class="checkbox-label">Support Vector Regression</div>
                                <div class="checkbox-desc">Good for high-dimensional spaces, robust to outliers</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="modelComparison" class="model-comparison" style="display: none;"></div>
            
            <div class="result-box" id="testResults" style="display: none;">
                <h3><i class="fas fa-medal"></i> Test & Score Results</h3>
                <div id="bestModelInfo"></div>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </section>
        
        <!-- Step 5: Make Predictions -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">5</div>
                <div class="step-title">Make Predictions with Best Model</div>
                <div class="step-time"><i class="fas fa-clock"></i> 15 min</div>
            </div>
            
            <div id="predictionControls" style="display: none;">
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.1rem; font-weight: 600; color: #2c3e50;">Using the best performing model:</div>
                            <div style="font-size: 1.4rem; font-weight: 700; color: #667eea;" id="bestModelName">None selected</div>
                        </div>
                    </div>
                </div>
                
                <div class="prediction-container">
                    <div class="prediction-input">
                        <h3><i class="fas fa-sliders-h"></i> Input Features for Prediction</h3>
                        <div id="predictionInputs">
                            <!-- Feature inputs will be generated here -->
                        </div>
                        <div class="button-group" style="justify-content: center; margin-top: 25px;">
                            <button onclick="makePrediction()">
                                <i class="fas fa-bolt"></i> Predict PM2.5
                            </button>
                            <button class="btn-secondary" onclick="generateRandomInputs()">
                                <i class="fas fa-random"></i> Random Inputs
                            </button>
                        </div>
                    </div>
                    
                    <div class="prediction-output">
                        <h3><i class="fas fa-chart-line"></i> Predicted Air Quality</h3>
                        <div class="prediction-label">PM2.5 Level:</div>
                        <div class="prediction-value" id="predictedPM25">--</div>
                        <div class="prediction-label">Air Quality:</div>
                        <div class="pm25-indicator" id="pm25Indicator">--</div>
                        <div id="airQualityLabel" style="margin: 15px 0; font-size: 1.1rem;">Click "Predict PM2.5" to see results</div>
                        <div id="confidenceInterval" style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <div id="noModelMessage" style="text-align: center; padding: 40px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); border-radius: 15px; border: 2px dashed #667eea;">
                <div style="font-size: 3rem; color: #667eea; margin-bottom: 20px;">
                    <i class="fas fa-robot"></i>
                </div>
                <div style="font-size: 1.5rem; font-weight: 600; color: #2c3e50; margin-bottom: 15px;">No Models Trained Yet</div>
                <p style="color: #7f8c8d; max-width: 600px; margin: 0 auto;">Please train models in <strong>Step 4</strong> to enable predictions. Click "Train & Compare All Models" to get started.</p>
            </div>
        </section>
        
        <!-- Step 6: Interpretation & Report -->
        <section class="lab-step">
            <div class="step-header">
                <div class="step-number">6</div>
                <div class="step-title">Interpret Results & Lab Report</div>
                <div class="step-time"><i class="fas fa-clock"></i> 20 min</div>
            </div>
            
            <div class="interpretation-box">
                <h3><i class="fas fa-question-circle"></i> Questions for Your Lab Report</h3>
                <p style="margin-bottom: 20px;">Answer these questions based on your experiment:</p>
                <ol style="margin: 10px 0 10px 25px;">
                    <li style="margin-bottom: 15px;"><strong>Which preprocessing steps improved model performance the most?</strong> Explain why these steps were effective.</li>
                    <li style="margin-bottom: 15px;"><strong>Which model performed best (highest R¬≤, lowest RMSE)?</strong> Why do you think this model worked best for this dataset?</li>
                    <li style="margin-bottom: 15px;"><strong>How does cross-validation score compare to simple train-test split?</strong> Discuss the importance of cross-validation.</li>
                    <li style="margin-bottom: 15px;"><strong>Which features were most important in predicting PM2.5 levels?</strong> Explain the relationship between these features and air quality.</li>
                    <li><strong>What limitations does your best model have?</strong> What additional features would you add to improve accuracy?</li>
                </ol>
                
                <div class="button-group">
                    <button onclick="generateReport()">
                        <i class="fas fa-file-alt"></i> Generate Lab Report
                    </button>
                    <button class="btn-secondary" onclick="saveAllResults()">
                        <i class="fas fa-save"></i> Save All Results
                    </button>
                    <button class="btn-tertiary" onclick="resetLab()">
                        <i class="fas fa-redo"></i> Reset Lab
                    </button>
                </div>
            </div>
        </section>
        
        <div class="developer-credit">
            <i class="fas fa-flask"></i> Developed by Dr. P. Selvarengan
        </div>
        
        <footer>
            <p><i class="fas fa-graduation-cap"></i> Virtual Lab Experiment: Air Quality Prediction with Machine Learning</p>
            <p>Features: CSV Upload ‚Ä¢ Data Preprocessing ‚Ä¢ Multiple ML Models ‚Ä¢ Cross-Validation ‚Ä¢ R¬≤ & RMSE Scores</p>
            <p>All computations are simulated for educational purposes.</p>
        </footer>
    </div>

    <div class="notification-area" id="notificationArea"></div>

    <script>
        // JavaScript code remains exactly the same as the previous version
        // Only CSS has been updated for better alignment and design
        // All functionality remains identical
        
        // Global variables
        let dataset = [];
        let processedData = [];
        let features = [];
        let target = 'PM2_5';
        let selectedFeatures = [];
        let models = {};
        let bestModel = null;
        let charts = {};
        let isDataLoaded = false;
        let isPreprocessed = false;
        
        // Initialize when page loads
        window.onload = function() {
            initializeCharts();
            showNotification('Welcome to Air Quality Prediction Lab! Load a dataset to begin.', 'info');
        };
        
        // Notification system
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}" style="font-size: 1.5rem;"></i>
                <div>${message}</div>
            `;
            
            notificationArea.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }
        
        // Step 2: CSV Upload functions
        function downloadSampleCSV() {
            const sampleCSV = `PM2.5 (¬µg/m¬≥),temperature (¬∞C),humidity (%),pressure (hPa),wind_speed (m/s)
12.5,15,65,1013,2.1
18.3,18,60,1012,2.8
25.6,22,55,1010,3.5
32.1,25,50,1008,4.2
45.8,28,45,1005,5.0
38.4,26,48,1006,4.5
22.7,20,58,1011,3.2
15.9,16,63,1013,2.4
28.3,23,53,1009,3.8
50.2,30,40,1003,5.5
41.7,27,43,1004,4.8
19.5,19,62,1012,2.9
34.6,24,47,1007,4.0
58.9,32,35,1000,6.2
31.2,25,52,1008,3.9
27.8,22,56,1010,3.6
14.2,17,68,1014,1.8
47.5,29,38,1002,5.8
36.9,26,45,1006,4.3
23.4,21,60,1011,3.4`;
            
            const blob = new Blob([sampleCSV], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'air_quality_sample.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Sample CSV template downloaded!', 'success');
        }
        
        function loadSampleDataset() {
            // Realistic sample data with proper relationships
            dataset = [
                {PM2_5: 12.5, temperature: 15, humidity: 65, pressure: 1013, wind_speed: 2.1},
                {PM2_5: 18.3, temperature: 18, humidity: 60, pressure: 1012, wind_speed: 2.8},
                {PM2_5: 25.6, temperature: 22, humidity: 55, pressure: 1010, wind_speed: 3.5},
                {PM2_5: 32.1, temperature: 25, humidity: 50, pressure: 1008, wind_speed: 4.2},
                {PM2_5: 45.8, temperature: 28, humidity: 45, pressure: 1005, wind_speed: 5.0},
                {PM2_5: 38.4, temperature: 26, humidity: 48, pressure: 1006, wind_speed: 4.5},
                {PM2_5: 22.7, temperature: 20, humidity: 58, pressure: 1011, wind_speed: 3.2},
                {PM2_5: 15.9, temperature: 16, humidity: 63, pressure: 1013, wind_speed: 2.4},
                {PM2_5: 28.3, temperature: 23, humidity: 53, pressure: 1009, wind_speed: 3.8},
                {PM2_5: 50.2, temperature: 30, humidity: 40, pressure: 1003, wind_speed: 5.5},
                {PM2_5: 41.7, temperature: 27, humidity: 43, pressure: 1004, wind_speed: 4.8},
                {PM2_5: 19.5, temperature: 19, humidity: 62, pressure: 1012, wind_speed: 2.9},
                {PM2_5: 34.6, temperature: 24, humidity: 47, pressure: 1007, wind_speed: 4.0},
                {PM2_5: 58.9, temperature: 32, humidity: 35, pressure: 1000, wind_speed: 6.2},
                {PM2_5: 31.2, temperature: 25, humidity: 52, pressure: 1008, wind_speed: 3.9},
                {PM2_5: 27.8, temperature: 22, humidity: 56, pressure: 1010, wind_speed: 3.6},
                {PM2_5: 14.2, temperature: 17, humidity: 68, pressure: 1014, wind_speed: 1.8},
                {PM2_5: 47.5, temperature: 29, humidity: 38, pressure: 1002, wind_speed: 5.8},
                {PM2_5: 36.9, temperature: 26, humidity: 45, pressure: 1006, wind_speed: 4.3},
                {PM2_5: 23.4, temperature: 21, humidity: 60, pressure: 1011, wind_speed: 3.4}
            ];
            
            // Define features
            features = ['temperature', 'humidity', 'pressure', 'wind_speed'];
            
            processUploadedData(dataset, features);
            showNotification('Sample dataset loaded successfully! 20 rows loaded.', 'success');
        }
        
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data.length === 0) {
                        showNotification('CSV file is empty or invalid!', 'error');
                        return;
                    }
                    
                    // Clean column names
                    const cleanedData = results.data.map(row => {
                        const cleanedRow = {};
                        Object.keys(row).forEach(key => {
                            // Remove special characters and normalize column names
                            let cleanKey = key.trim()
                                .replace(/[^a-zA-Z0-9]/g, '_')
                                .replace(/_{2,}/g, '_')
                                .replace(/_+$/, '')
                                .toLowerCase();
                            
                            // Standardize common column names
                            if (cleanKey.includes('pm2') || cleanKey.includes('pm25')) {
                                cleanKey = 'PM2_5';
                            } else if (cleanKey.includes('temp')) {
                                cleanKey = 'temperature';
                            } else if (cleanKey.includes('hum')) {
                                cleanKey = 'humidity';
                            } else if (cleanKey.includes('press')) {
                                cleanKey = 'pressure';
                            } else if (cleanKey.includes('wind')) {
                                cleanKey = 'wind_speed';
                            }
                            
                            cleanedRow[cleanKey] = row[key];
                        });
                        return cleanedRow;
                    });
                    
                    // Identify numeric columns as features (excluding PM2_5)
                    const firstRow = cleanedData[0];
                    const numericColumns = Object.keys(firstRow).filter(key => {
                        const value = firstRow[key];
                        return typeof value === 'number' && key !== 'PM2_5';
                    });
                    
                    // Ensure PM2_5 exists, if not use first numeric column
                    let hasPM25 = cleanedData.some(row => row.PM2_5 !== undefined);
                    if (!hasPM25 && numericColumns.length > 0) {
                        // Rename first numeric column to PM2_5
                        const firstNumCol = numericColumns[0];
                        cleanedData.forEach(row => {
                            row.PM2_5 = row[firstNumCol];
                            delete row[firstNumCol];
                        });
                        numericColumns.shift(); // Remove from features
                    }
                    
                    // Filter out non-numeric values
                    const validData = cleanedData.filter(row => {
                        return row.PM2_5 !== undefined && 
                               typeof row.PM2_5 === 'number' &&
                               !isNaN(row.PM2_5);
                    });
                    
                    if (validData.length === 0) {
                        showNotification('No valid numeric data found in CSV!', 'error');
                        return;
                    }
                    
                    processUploadedData(validData, numericColumns);
                    showNotification(`CSV uploaded successfully! ${validData.length} rows loaded.`, 'success');
                },
                error: function(error) {
                    showNotification('Error parsing CSV file: ' + error.message, 'error');
                }
            });
        }
        
        function processUploadedData(data, featureColumns) {
            dataset = data;
            features = featureColumns;
            
            // Update dataset info
            document.getElementById('rowCount').textContent = dataset.length;
            document.getElementById('colCount').textContent = features.length + 1;
            
            // Calculate missing values
            let missingCount = 0;
            dataset.forEach(row => {
                Object.values(row).forEach(val => {
                    if (val === null || val === undefined || isNaN(val)) missingCount++;
                });
            });
            document.getElementById('missingValues').textContent = missingCount;
            
            // Show data preview
            showDataPreview();
            
            // Update feature selection
            updateFeatureSelectionUI();
            
            // Show preprocessing section
            document.getElementById('preprocessingSection').style.display = 'block';
            document.getElementById('dataInfo').style.display = 'block';
            
            isDataLoaded = true;
            isPreprocessed = false;
            
            // Initialize feature selection
            updateFeatureSelection();
        }
        
        function showDataPreview() {
            const head = document.getElementById('datasetHead');
            const body = document.getElementById('datasetBody');
            
            // Clear previous content
            head.innerHTML = '';
            body.innerHTML = '';
            
            // Create header with units
            const headerRow = document.createElement('tr');
            const allColumns = [
                {name: 'PM2_5', unit: '¬µg/m¬≥'},
                ...features.map(f => {
                    let unit = '';
                    if (f.includes('temp')) unit = '¬∞C';
                    else if (f.includes('hum')) unit = '%';
                    else if (f.includes('press')) unit = 'hPa';
                    else if (f.includes('wind')) unit = 'm/s';
                    return {name: f, unit: unit};
                })
            ];
            
            allColumns.forEach(col => {
                const th = document.createElement('th');
                th.innerHTML = `${col.name} <span class="unit-badge">${col.unit}</span>`;
                headerRow.appendChild(th);
            });
            head.appendChild(headerRow);
            
            // Create data rows (first 10)
            const previewData = dataset.slice(0, 10);
            previewData.forEach(row => {
                const tr = document.createElement('tr');
                allColumns.forEach(col => {
                    const td = document.createElement('td');
                    const value = row[col.name];
                    td.textContent = value !== undefined && value !== null ? 
                        (typeof value === 'number' ? value.toFixed(2) : value) : 'N/A';
                    tr.appendChild(td);
                });
                body.appendChild(tr);
            });
            
            document.getElementById('dataPreview').style.display = 'block';
        }
        
        function updateFeatureSelectionUI() {
            const targetSelect = document.getElementById('targetSelect');
            const featureCheckboxes = document.getElementById('featureCheckboxes');
            
            // Clear previous options
            targetSelect.innerHTML = '';
            featureCheckboxes.innerHTML = '';
            
            // Add PM2_5 as default target
            const option = document.createElement('option');
            option.value = 'PM2_5';
            option.textContent = 'PM2.5 (¬µg/m¬≥)';
            option.selected = true;
            targetSelect.appendChild(option);
            
            // Add feature checkboxes with icons and units
            features.forEach(feature => {
                let icon = 'cube';
                let unit = '';
                
                if (feature.includes('temp')) {
                    icon = 'thermometer-half';
                    unit = '¬∞C';
                } else if (feature.includes('hum')) {
                    icon = 'tint';
                    unit = '%';
                } else if (feature.includes('press')) {
                    icon = 'tachometer-alt';
                    unit = 'hPa';
                } else if (feature.includes('wind')) {
                    icon = 'wind';
                    unit = 'm/s';
                }
                
                const div = document.createElement('div');
                div.className = 'checkbox-card';
                div.innerHTML = `
                    <input type="checkbox" id="feat_${feature}" checked onchange="updateFeatureSelection()">
                    <div style="display: flex; align-items: center; gap: 15px; width: 100%;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-${icon}"></i>
                        </div>
                        <div style="flex-grow: 1;">
                            <div class="checkbox-label">${feature} <span class="unit-badge">${unit}</span></div>
                            <div class="checkbox-desc">Environmental factor affecting air quality</div>
                        </div>
                    </div>
                `;
                featureCheckboxes.appendChild(div);
            });
            
            // Update selected features initially
            updateFeatureSelection();
        }
        
        function updateFeatureSelection() {
            target = document.getElementById('targetSelect').value;
            
            // Update selected features
            selectedFeatures = [];
            features.forEach(feature => {
                const checkbox = document.getElementById(`feat_${feature}`);
                if (checkbox && checkbox.checked) {
                    selectedFeatures.push(feature);
                }
            });
            
            // Update feature chart dropdown
            updateFeatureChartDropdown();
        }
        
        function applyPreprocessing() {
            if (dataset.length === 0) {
                showNotification('No data to preprocess!', 'error');
                return;
            }
            
            if (selectedFeatures.length === 0) {
                showNotification('Please select at least one feature!', 'error');
                return;
            }
            
            // Show processing animation
            const button = document.querySelector('#preprocessingSection .btn-secondary');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            button.disabled = true;
            
            setTimeout(() => {
                processedData = JSON.parse(JSON.stringify(dataset)); // Deep copy
                
                const removeMissing = document.getElementById('removeMissing').checked;
                const normalizeData = document.getElementById('normalizeData').checked;
                const removeOutliers = document.getElementById('removeOutliers').checked;
                const logTransform = document.getElementById('logTransform').checked;
                
                let stepsApplied = [];
                
                // Remove missing values
                if (removeMissing) {
                    const initialCount = processedData.length;
                    processedData = processedData.filter(row => {
                        // Check target
                        if (row[target] === null || row[target] === undefined || isNaN(row[target])) {
                            return false;
                        }
                        // Check selected features
                        for (const feature of selectedFeatures) {
                            if (row[feature] === null || row[feature] === undefined || isNaN(row[feature])) {
                                return false;
                            }
                        }
                        return true;
                    });
                    const removed = initialCount - processedData.length;
                    if (removed > 0) {
                        stepsApplied.push(`Removed ${removed} rows with missing values`);
                    }
                }
                
                // Apply log transformation to target
                if (logTransform && target === 'PM2_5') {
                    processedData.forEach(row => {
                        if (row[target] > 0) {
                            row[target] = Math.log(row[target] + 1);
                        }
                    });
                    stepsApplied.push('Applied log transformation to PM2.5');
                }
                
                // Remove outliers (beyond 3 standard deviations)
                if (removeOutliers) {
                    selectedFeatures.forEach(feature => {
                        const values = processedData.map(row => row[feature]).filter(v => !isNaN(v));
                        if (values.length > 0) {
                            const mean = values.reduce((a, b) => a + b, 0) / values.length;
                            const std = Math.sqrt(values.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / values.length);
                            
                            if (std > 0) {
                                const initialCount = processedData.length;
                                processedData = processedData.filter(row => {
                                    const val = row[feature];
                                    return Math.abs(val - mean) <= 3 * std;
                                });
                                const removed = initialCount - processedData.length;
                                if (removed > 0) {
                                    stepsApplied.push(`Removed ${removed} outliers from ${feature}`);
                                }
                            }
                        }
                    });
                }
                
                // Normalize features (0-1 scaling)
                if (normalizeData) {
                    selectedFeatures.forEach(feature => {
                        const values = processedData.map(row => row[feature]).filter(v => !isNaN(v));
                        const min = Math.min(...values);
                        const max = Math.max(...values);
                        
                        if (max > min) {
                            processedData.forEach(row => {
                                row[feature] = (row[feature] - min) / (max - min);
                            });
                            stepsApplied.push(`Normalized ${feature} to 0-1 range`);
                        }
                    });
                }
                
                isPreprocessed = true;
                
                if (stepsApplied.length === 0) {
                    stepsApplied.push('No preprocessing steps applied (using raw data)');
                }
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                showNotification(`Preprocessing applied! ${processedData.length} rows remaining.`, 'success');
                
                // Update visualizations
                updateFeatureChart();
                updateCorrelationChart();
                
            }, 1000); // Simulate processing time
        }
        
        // Step 3: Visualization functions
        function initializeCharts() {
            // Feature chart
            const featureCtx = document.getElementById('featureChart').getContext('2d');
            charts.featureChart = new Chart(featureCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Feature vs Target',
                        data: [],
                        backgroundColor: '#667eea',
                        borderColor: '#764ba2',
                        borderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Feature Value',
                                font: { size: 14, weight: 'bold' },
                                color: '#2c3e50'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'PM2.5 (¬µg/m¬≥)',
                                font: { size: 14, weight: 'bold' },
                                color: '#2c3e50'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(44, 62, 80, 0.9)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            padding: 12,
                            cornerRadius: 8
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Correlation chart
            const corrCtx = document.getElementById('correlationChart').getContext('2d');
            charts.correlationChart = new Chart(corrCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Correlation with PM2.5',
                        data: [],
                        backgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            if (value > 0.7) return '#27ae60';
                            if (value > 0.3) return '#2ecc71';
                            if (value > -0.3) return '#f1c40f';
                            if (value > -0.7) return '#e67e22';
                            return '#e74c3c';
                        },
                        borderColor: '#2c3e50',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Correlation Coefficient',
                                font: { size: 14, weight: 'bold' },
                                color: '#2c3e50'
                            },
                            min: -1,
                            max: 1,
                            grid: {
                                color: function(context) {
                                    if (context.tick.value === 0) return '#2c3e50';
                                    return '#ecf0f1';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(44, 62, 80, 0.9)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    let strength = '';
                                    if (Math.abs(value) > 0.7) strength = 'Strong ';
                                    else if (Math.abs(value) > 0.3) strength = 'Moderate ';
                                    else strength = 'Weak ';
                                    
                                    return `${strength}${value > 0 ? 'positive' : 'negative'} correlation: ${value.toFixed(3)}`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Performance chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            charts.performanceChart = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'R¬≤ Score',
                            data: [],
                            backgroundColor: '#667eea',
                            borderColor: '#764ba2',
                            borderWidth: 2,
                            borderRadius: 5,
                            yAxisID: 'y'
                        },
                        {
                            label: 'RMSE',
                            data: [],
                            backgroundColor: '#e74c3c',
                            borderColor: '#c0392b',
                            borderWidth: 2,
                            borderRadius: 5,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'R¬≤ Score',
                                font: { size: 14, weight: 'bold' },
                                color: '#2c3e50'
                            },
                            min: 0,
                            max: 1,
                            position: 'left'
                        },
                        y1: {
                            title: {
                                display: true,
                                text: 'RMSE (¬µg/m¬≥)',
                                font: { size: 14, weight: 'bold' },
                                color: '#e74c3c'
                            },
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(44, 62, 80, 0.9)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            padding: 12,
                            cornerRadius: 8
                        }
                    }
                }
            });
        }
        
        function updateFeatureChartDropdown() {
            const featureSelect = document.getElementById('featureSelect');
            featureSelect.innerHTML = '';
            
            selectedFeatures.forEach(feature => {
                let unit = '';
                if (feature.includes('temp')) unit = '¬∞C';
                else if (feature.includes('hum')) unit = '%';
                else if (feature.includes('press')) unit = 'hPa';
                else if (feature.includes('wind')) unit = 'm/s';
                
                const option = document.createElement('option');
                option.value = feature;
                option.textContent = `${feature} (${unit})`;
                featureSelect.appendChild(option);
            });
            
            if (selectedFeatures.length > 0) {
                updateFeatureChart();
            } else {
                // Clear chart if no features selected
                charts.featureChart.data.datasets[0].data = [];
                charts.featureChart.update();
            }
        }
        
        function updateFeatureChart() {
            if (!isPreprocessed || processedData.length === 0 || selectedFeatures.length === 0) {
                // Show message on chart
                charts.featureChart.data.datasets[0].data = [];
                charts.featureChart.update();
                return;
            }
            
            const selectedFeature = document.getElementById('featureSelect').value;
            if (!selectedFeature) return;
            
            // Filter out any invalid data points
            const data = processedData
                .filter(row => {
                    const x = row[selectedFeature];
                    const y = row[target];
                    return x !== null && x !== undefined && !isNaN(x) &&
                           y !== null && y !== undefined && !isNaN(y);
                })
                .map(row => ({
                    x: row[selectedFeature],
                    y: row[target]
                }));
            
            if (data.length === 0) {
                showNotification(`No valid data points for ${selectedFeature} vs ${target}`, 'warning');
                return;
            }
            
            charts.featureChart.data.datasets[0].data = data;
            charts.featureChart.data.datasets[0].label = `${selectedFeature} vs ${target}`;
            
            // Update x-axis label with unit
            let unit = '';
            if (selectedFeature.includes('temp')) unit = '¬∞C';
            else if (selectedFeature.includes('hum')) unit = '%';
            else if (selectedFeature.includes('press')) unit = 'hPa';
            else if (selectedFeature.includes('wind')) unit = 'm/s';
            
            charts.featureChart.options.scales.x.title.text = `${selectedFeature} (${unit})`;
            
            // If log transform was applied, update y-axis label
            const logTransform = document.getElementById('logTransform').checked;
            charts.featureChart.options.scales.y.title.text = 
                logTransform ? 'log(PM2.5 + 1)' : 'PM2.5 (¬µg/m¬≥)';
            
            charts.featureChart.update();
        }
        
        function updateCorrelationChart() {
            if (!isPreprocessed || processedData.length === 0 || selectedFeatures.length === 0) {
                charts.correlationChart.data.labels = [];
                charts.correlationChart.data.datasets[0].data = [];
                charts.correlationChart.update();
                return;
            }
            
            const correlations = [];
            selectedFeatures.forEach(feature => {
                // Get valid data points for this feature and target
                const validData = processedData.filter(row => {
                    const x = row[feature];
                    const y = row[target];
                    return x !== null && x !== undefined && !isNaN(x) &&
                           y !== null && y !== undefined && !isNaN(y);
                });
                
                if (validData.length < 2) {
                    correlations.push({
                        feature: feature,
                        correlation: 0
                    });
                    return;
                }
                
                const xVals = validData.map(row => row[feature]);
                const yVals = validData.map(row => row[target]);
                
                // Calculate correlation coefficient
                const meanX = xVals.reduce((a, b) => a + b, 0) / xVals.length;
                const meanY = yVals.reduce((a, b) => a + b, 0) / yVals.length;
                
                let numerator = 0;
                let denomX = 0;
                let denomY = 0;
                
                for (let i = 0; i < xVals.length; i++) {
                    numerator += (xVals[i] - meanX) * (yVals[i] - meanY);
                    denomX += Math.pow(xVals[i] - meanX, 2);
                    denomY += Math.pow(yVals[i] - meanY, 2);
                }
                
                let correlation = 0;
                if (denomX > 0 && denomY > 0) {
                    correlation = numerator / Math.sqrt(denomX * denomY);
                }
                
                correlations.push({
                    feature: feature,
                    correlation: isNaN(correlation) ? 0 : correlation
                });
            });
            
            // Sort by absolute correlation (strongest first)
            correlations.sort((a, b) => Math.abs(b.correlation) - Math.abs(a.correlation));
            
            // Add units to feature labels
            const labelsWithUnits = correlations.map(c => {
                let unit = '';
                if (c.feature.includes('temp')) unit = '¬∞C';
                else if (c.feature.includes('hum')) unit = '%';
                else if (c.feature.includes('press')) unit = 'hPa';
                else if (c.feature.includes('wind')) unit = 'm/s';
                return `${c.feature} (${unit})`;
            });
            
            charts.correlationChart.data.labels = labelsWithUnits;
            charts.correlationChart.data.datasets[0].data = correlations.map(c => c.correlation);
            charts.correlationChart.update();
        }
        
        // Step 4: Model training and evaluation
        function updateSplitValue() {
            document.getElementById('splitValue').textContent = 
                document.getElementById('trainSplit').value + '%';
        }
        
        function runAllModels() {
            if (!isPreprocessed || processedData.length < 10) {
                showNotification('Need at least 10 preprocessed data points to train models!', 'error');
                return;
            }
            
            if (selectedFeatures.length === 0) {
                showNotification('Please select at least one feature for training!', 'error');
                return;
            }
            
            // Get selected models
            const selectedModels = [];
            if (document.getElementById('modelLinear').checked) selectedModels.push('Linear Regression');
            if (document.getElementById('modelRandomForest').checked) selectedModels.push('Random Forest');
            if (document.getElementById('modelDecisionTree').checked) selectedModels.push('Decision Tree');
            if (document.getElementById('modelSVR').checked) selectedModels.push('SVR');
            
            if (selectedModels.length === 0) {
                showNotification('Please select at least one model to train!', 'error');
                return;
            }
            
            const trainSplit = parseInt(document.getElementById('trainSplit').value) / 100;
            const cvFolds = parseInt(document.getElementById('cvFolds').value);
            
            // Show loading animation
            const button = document.querySelector('#modelComparison + .button-group button');
            if (button) {
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Training Models...';
                button.disabled = true;
            }
            
            // Show progress bar
            showNotification(`Training ${selectedModels.length} model(s) with ${cvFolds}-fold cross-validation...`, 'info');
            
            // Simulate training time
            setTimeout(() => {
                // Prepare data
                const X = processedData.map(row => selectedFeatures.map(f => row[f]));
                const y = processedData.map(row => row[target]);
                
                // Split data
                const splitIndex = Math.floor(X.length * trainSplit);
                const X_train = X.slice(0, splitIndex);
                const X_test = X.slice(splitIndex);
                const y_train = y.slice(0, splitIndex);
                const y_test = y.slice(splitIndex);
                
                // Train and evaluate each model
                const modelResults = {};
                let bestR2 = -Infinity;
                let bestModelName = '';
                
                selectedModels.forEach(modelName => {
                    const results = trainAndEvaluateModel(modelName, X_train, y_train, X_test, y_test, cvFolds);
                    modelResults[modelName] = results;
                    
                    if (results.cv_r2 > bestR2) {
                        bestR2 = results.cv_r2;
                        bestModelName = modelName;
                    }
                });
                
                // Store best model
                bestModel = {
                    name: bestModelName,
                    ...modelResults[bestModelName]
                };
                
                // Display results
                displayModelComparison(modelResults);
                updatePerformanceChart(modelResults);
                
                // Enable predictions
                document.getElementById('predictionControls').style.display = 'block';
                document.getElementById('noModelMessage').style.display = 'none';
                document.getElementById('bestModelName').textContent = bestModelName;
                
                // Generate prediction inputs
                generatePredictionInputs();
                
                // Reset button
                if (button) {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
                
                showNotification(`Models trained successfully! Best model: ${bestModelName} (CV R¬≤: ${bestR2.toFixed(3)})`, 'success');
                
            }, 2000); // Simulate training time
        }
        
        function trainAndEvaluateModel(modelName, X_train, y_train, X_test, y_test, cvFolds) {
            // Simulated model training and evaluation
            const results = {
                train_r2: 0,
                test_r2: 0,
                cv_r2: 0,
                train_rmse: 0,
                test_rmse: 0,
                cv_rmse: 0,
                feature_importance: []
            };
            
            // Base performance based on data characteristics
            // Calculate actual correlations from data
            const avgCorrelation = calculateAverageCorrelation(X_train, y_train, selectedFeatures);
            
            // Different models have different strengths
            switch(modelName) {
                case 'Linear Regression':
                    // Linear models work well when relationships are linear
                    results.train_r2 = Math.min(0.95, Math.max(0.5, avgCorrelation * 0.9 + 0.3));
                    results.test_r2 = results.train_r2 * 0.9; // Slight overfitting
                    results.cv_r2 = results.train_r2 * 0.95; // CV is between train and test
                    results.train_rmse = 10 + (1 - results.train_r2) * 20;
                    results.test_rmse = results.train_rmse * 1.2;
                    results.cv_rmse = results.train_rmse * 1.1;
                    // Feature importance based on correlation
                    selectedFeatures.forEach((feat, idx) => {
                        // Simulate feature importance
                        const importance = 0.2 + Math.random() * 0.6;
                        results.feature_importance.push({
                            feature: feat,
                            importance: importance
                        });
                    });
                    break;
                    
                case 'Random Forest':
                    // RF can capture non-linear relationships
                    results.train_r2 = Math.min(0.98, Math.max(0.6, avgCorrelation * 0.8 + 0.4));
                    results.test_r2 = results.train_r2 * 0.85; // More overfitting
                    results.cv_r2 = results.train_r2 * 0.92;
                    results.train_rmse = 5 + (1 - results.train_r2) * 15;
                    results.test_rmse = results.train_rmse * 1.5;
                    results.cv_rmse = results.train_rmse * 1.3;
                    // Random Forest feature importance (more varied)
                    selectedFeatures.forEach((feat, idx) => {
                        const importance = 0.1 + Math.random() * 0.8;
                        results.feature_importance.push({
                            feature: feat,
                            importance: importance
                        });
                    });
                    break;
                    
                case 'Decision Tree':
                    results.train_r2 = Math.min(0.99, Math.max(0.55, avgCorrelation * 0.7 + 0.45));
                    results.test_r2 = results.train_r2 * 0.8;
                    results.cv_r2 = results.train_r2 * 0.85;
                    results.train_rmse = 3 + (1 - results.train_r2) * 12;
                    results.test_rmse = results.train_rmse * 1.8;
                    results.cv_rmse = results.train_rmse * 1.5;
                    break;
                    
                case 'SVR':
                    results.train_r2 = Math.min(0.97, Math.max(0.5, avgCorrelation * 0.85 + 0.35));
                    results.test_r2 = results.train_r2 * 0.88;
                    results.cv_r2 = results.train_r2 * 0.93;
                    results.train_rmse = 8 + (1 - results.train_r2) * 18;
                    results.test_rmse = results.train_rmse * 1.3;
                    results.cv_rmse = results.train_rmse * 1.15;
                    break;
            }
            
            // Normalize feature importance to sum to 1
            const totalImp = results.feature_importance.reduce((sum, fi) => sum + fi.importance, 0);
            if (totalImp > 0) {
                results.feature_importance.forEach(fi => {
                    fi.importance = fi.importance / totalImp;
                });
            }
            
            // Sort feature importance
            results.feature_importance.sort((a, b) => b.importance - a.importance);
            
            return results;
        }
        
        function calculateAverageCorrelation(X, y, features) {
            // Calculate average absolute correlation between features and target
            let totalCorr = 0;
            let count = 0;
            
            for (let i = 0; i < features.length; i++) {
                const xVals = X.map(row => row[i]);
                const meanX = xVals.reduce((a, b) => a + b, 0) / xVals.length;
                const meanY = y.reduce((a, b) => a + b, 0) / y.length;
                
                let numerator = 0;
                let denomX = 0;
                let denomY = 0;
                
                for (let j = 0; j < xVals.length; j++) {
                    numerator += (xVals[j] - meanX) * (y[j] - meanY);
                    denomX += Math.pow(xVals[j] - meanX, 2);
                    denomY += Math.pow(y[j] - meanY, 2);
                }
                
                if (denomX > 0 && denomY > 0) {
                    const correlation = Math.abs(numerator / Math.sqrt(denomX * denomY));
                    totalCorr += correlation;
                    count++;
                }
            }
            
            return count > 0 ? totalCorr / count : 0.5; // Default to 0.5 if can't calculate
        }
        
        function displayModelComparison(modelResults) {
            const comparisonDiv = document.getElementById('modelComparison');
            comparisonDiv.innerHTML = '';
            comparisonDiv.style.display = 'grid';
            
            let bestR2 = -Infinity;
            let bestModelName = '';
            
            Object.keys(modelResults).forEach(modelName => {
                const results = modelResults[modelName];
                if (results.cv_r2 > bestR2) {
                    bestR2 = results.cv_r2;
                    bestModelName = modelName;
                }
                
                // Get model icon
                let iconClass = '';
                let icon = '';
                if (modelName === 'Linear Regression') {
                    iconClass = 'linear-icon';
                    icon = 'chart-line';
                } else if (modelName === 'Random Forest') {
                    iconClass = 'rf-icon';
                    icon = 'tree';
                } else if (modelName === 'Decision Tree') {
                    iconClass = 'dt-icon';
                    icon = 'project-diagram';
                } else if (modelName === 'SVR') {
                    iconClass = 'svr-icon';
                    icon = 'bezier-curve';
                }
                
                const card = document.createElement('div');
                card.className = 'model-card';
                if (modelName === bestModelName) {
                    card.classList.add('best-model');
                    card.innerHTML = `<div class="best-badge"><i class="fas fa-crown"></i> Best Model</div>`;
                }
                
                card.innerHTML += `
                    <h4>
                        <div class="model-icon ${iconClass}">
                            <i class="fas fa-${icon}"></i>
                        </div>
                        ${modelName}
                    </h4>
                    <div class="model-stats">
                        <div class="stat-card">
                            <div class="stat-value">${results.cv_r2.toFixed(3)}</div>
                            <div class="stat-label">CV R¬≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${results.test_r2.toFixed(3)}</div>
                            <div class="stat-label">Test R¬≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${results.cv_rmse.toFixed(1)}</div>
                            <div class="stat-label">CV RMSE</div>
                            <div class="feature-unit">¬µg/m¬≥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${results.test_rmse.toFixed(1)}</div>
                            <div class="stat-label">Test RMSE</div>
                            <div class="feature-unit">¬µg/m¬≥</div>
                        </div>
                    </div>
                `;
                
                comparisonDiv.appendChild(card);
            });
            
            // Show test results section
            document.getElementById('testResults').style.display = 'block';
            document.getElementById('bestModelInfo').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <div style="font-weight: 600; color: #7f8c8d; font-size: 0.9rem;">Best Model</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #667eea;">${bestModelName}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <div style="font-weight: 600; color: #7f8c8d; font-size: 0.9rem;">Cross-validation R¬≤</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #27ae60;">${bestR2.toFixed(3)}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <div style="font-weight: 600; color: #7f8c8d; font-size: 0.9rem;">Train-Test Split</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #3498db;">${document.getElementById('trainSplit').value}% / ${100 - parseInt(document.getElementById('trainSplit').value)}%</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <div style="font-weight: 600; color: #7f8c8d; font-size: 0.9rem;">Cross-Validation</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: #9b59b6;">${document.getElementById('cvFolds').value}-fold CV</div>
                    </div>
                </div>
            `;
        }
        
        function updatePerformanceChart(modelResults) {
            const modelNames = Object.keys(modelResults);
            const r2Scores = modelNames.map(name => modelResults[name].cv_r2);
            const rmseScores = modelNames.map(name => modelResults[name].cv_rmse);
            
            charts.performanceChart.data.labels = modelNames;
            charts.performanceChart.data.datasets[0].data = r2Scores;
            charts.performanceChart.data.datasets[1].data = rmseScores;
            charts.performanceChart.update();
        }
        
        // Step 5: Prediction functions
        function generatePredictionInputs() {
            const inputsDiv = document.getElementById('predictionInputs');
            inputsDiv.innerHTML = '';
            
            if (selectedFeatures.length === 0) {
                inputsDiv.innerHTML = '<p>No features selected for prediction.</p>';
                return;
            }
            
            selectedFeatures.forEach(feature => {
                // Get min and max values for this feature from processed data
                const values = processedData.map(row => row[feature]).filter(v => !isNaN(v));
                if (values.length === 0) return;
                
                const minVal = Math.min(...values);
                const maxVal = Math.max(...values);
                const avgVal = (minVal + maxVal) / 2;
                
                // Determine step size (1% of range)
                const step = (maxVal - minVal) / 100;
                
                // Get unit for this feature
                let unit = '';
                if (feature.includes('temp')) unit = '¬∞C';
                else if (feature.includes('hum')) unit = '%';
                else if (feature.includes('press')) unit = 'hPa';
                else if (feature.includes('wind')) unit = 'm/s';
                
                const div = document.createElement('div');
                div.className = 'slider-container';
                div.innerHTML = `
                    <div class="slider-label">
                        <span>${feature} <span class="feature-unit">(${unit})</span>:</span>
                        <span id="${feature}Value">${avgVal.toFixed(2)}</span>
                    </div>
                    <input type="range" id="${feature}Slider" 
                           min="${minVal.toFixed(2)}" max="${maxVal.toFixed(2)}" 
                           step="${step.toFixed(4)}" value="${avgVal.toFixed(2)}" 
                           oninput="updateInputValue('${feature}')">
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #7f8c8d; margin-top: 5px;">
                        <span>${minVal.toFixed(1)} ${unit}</span>
                        <span>${maxVal.toFixed(1)} ${unit}</span>
                    </div>
                `;
                inputsDiv.appendChild(div);
            });
        }
        
        function updateInputValue(feature) {
            const slider = document.getElementById(`${feature}Slider`);
            const valueSpan = document.getElementById(`${feature}Value`);
            valueSpan.textContent = parseFloat(slider.value).toFixed(2);
        }
        
        function generateRandomInputs() {
            selectedFeatures.forEach(feature => {
                const values = processedData.map(row => row[feature]).filter(v => !isNaN(v));
                if (values.length === 0) return;
                
                const minVal = Math.min(...values);
                const maxVal = Math.max(...values);
                const randomVal = minVal + Math.random() * (maxVal - minVal);
                
                const slider = document.getElementById(`${feature}Slider`);
                const valueSpan = document.getElementById(`${feature}Value`);
                
                if (slider && valueSpan) {
                    slider.value = randomVal.toFixed(4);
                    valueSpan.textContent = randomVal.toFixed(2);
                }
            });
            
            showNotification('Random values generated for all features!', 'info');
        }
        
        function makePrediction() {
            if (!bestModel) {
                showNotification('No model trained yet! Train models in Step 4 first.', 'error');
                return;
            }
            
            if (selectedFeatures.length === 0) {
                showNotification('No features selected for prediction.', 'error');
                return;
            }
            
            // Collect input values
            const inputValues = {};
            let allValid = true;
            
            selectedFeatures.forEach(feature => {
                const slider = document.getElementById(`${feature}Slider`);
                if (!slider) {
                    allValid = false;
                    return;
                }
                const value = parseFloat(slider.value);
                if (isNaN(value)) {
                    allValid = false;
                    return;
                }
                inputValues[feature] = value;
            });
            
            if (!allValid) {
                showNotification('Please enter valid values for all features.', 'error');
                return;
            }
            
            // Simulate prediction based on model type and feature importance
            let prediction = 0;
            let confidence = 0.9; // Base confidence
            
            // Base prediction based on feature values and importance
            let totalImportance = 0;
            selectedFeatures.forEach(feature => {
                const featureImp = bestModel.feature_importance.find(fi => fi.feature === feature);
                const importance = featureImp ? featureImp.importance : 1 / selectedFeatures.length;
                
                // Normalize input value (assuming 0-1 range from preprocessing)
                const normalizedValue = inputValues[feature];
                
                // Different models use features differently
                switch(bestModel.name) {
                    case 'Linear Regression':
                        prediction += normalizedValue * importance * 80;
                        break;
                    case 'Random Forest':
                        // RF can capture non-linear relationships
                        prediction += normalizedValue * importance * 70;
                        // Add some non-linearity
                        if (feature === 'temperature') {
                            prediction += Math.pow(normalizedValue, 1.5) * 10;
                        }
                        break;
                    default:
                        prediction += normalizedValue * importance * 75;
                }
                
                totalImportance += importance;
            });
            
            // Average the prediction
            if (totalImportance > 0) {
                prediction = prediction / totalImportance;
            }
            
            // Add model-specific adjustments
            switch(bestModel.name) {
                case 'Linear Regression':
                    confidence = 0.85;
                    break;
                case 'Random Forest':
                    confidence = 0.92;
                    // Add some random forest "ensemble" effect
                    prediction += (Math.random() - 0.5) * prediction * 0.1;
                    break;
                case 'Decision Tree':
                    confidence = 0.80;
                    // Decision trees can be less stable
                    prediction += (Math.random() - 0.5) * prediction * 0.15;
                    break;
                case 'SVR':
                    confidence = 0.88;
                    break;
            }
            
            // Add some noise based on model RMSE
            const noise = (Math.random() - 0.5) * bestModel.cv_rmse;
            prediction += noise;
            
            // If log transform was applied, reverse it
            const logTransform = document.getElementById('logTransform').checked;
            if (logTransform && target === 'PM2_5') {
                prediction = Math.exp(prediction) - 1;
            }
            
            // Ensure prediction is positive
            prediction = Math.max(1, prediction);
            
            displayPrediction(prediction, confidence);
        }
        
        function displayPrediction(prediction, confidence) {
            const roundedPrediction = Math.round(prediction * 10) / 10;
            document.getElementById('predictedPM25').textContent = roundedPrediction;
            
            // Determine air quality level
            let quality, colorClass, description;
            
            if (roundedPrediction <= 12) {
                quality = "Good";
                colorClass = "good";
                description = "Air quality is satisfactory";
            } else if (roundedPrediction <= 35.4) {
                quality = "Moderate";
                colorClass = "moderate";
                description = "Acceptable air quality";
            } else if (roundedPrediction <= 55.4) {
                quality = "Unhealthy for Sensitive Groups";
                colorClass = "unhealthy";
                description = "Possible health effects for sensitive people";
            } else if (roundedPrediction <= 150.4) {
                quality = "Unhealthy";
                colorClass = "very-unhealthy";
                description = "Health effects for everyone";
            } else {
                quality = "Hazardous";
                colorClass = "hazardous";
                description = "Emergency health warnings";
            }
            
            const indicator = document.getElementById('pm25Indicator');
            indicator.textContent = quality;
            indicator.className = `pm25-indicator ${colorClass}`;
            
            document.getElementById('airQualityLabel').textContent = description;
            
            // Show confidence interval
            const margin = (1 - confidence) * bestModel.cv_rmse;
            document.getElementById('confidenceInterval').innerHTML = `
                <div style="margin-bottom: 8px;">
                    <i class="fas fa-shield-alt"></i> <strong>Model Confidence:</strong> ${(confidence * 100).toFixed(0)}%
                </div>
                <div style="margin-bottom: 8px;">
                    <i class="fas fa-chart-line"></i> <strong>Prediction Range:</strong> ${Math.max(0, roundedPrediction - margin).toFixed(1)} - ${(roundedPrediction + margin).toFixed(1)} ¬µg/m¬≥
                </div>
                <div style="font-size: 0.8rem; opacity: 0.8;">
                    <i class="fas fa-info-circle"></i> Based on model RMSE: ${bestModel.cv_rmse.toFixed(1)} ¬µg/m¬≥
                </div>
            `;
            
            showNotification(`Prediction: ${roundedPrediction} ¬µg/m¬≥ (${quality})`, 'success');
        }
        
        // Step 6: Report generation
        function generateReport() {
            if (!bestModel) {
                showNotification('Please train models first to generate a report!', 'error');
                return;
            }
            
            const preprocessingSteps = getPreprocessingSummary();
            const featuresUsed = selectedFeatures.map(f => {
                if (f.includes('temp')) return `${f} (¬∞C)`;
                if (f.includes('hum')) return `${f} (%)`;
                if (f.includes('press')) return `${f} (hPa)`;
                if (f.includes('wind')) return `${f} (m/s)`;
                return f;
            }).join(', ');
            
            const topFeatures = bestModel.feature_importance.slice(0, 3).map(fi => {
                let unit = '';
                if (fi.feature.includes('temp')) unit = '¬∞C';
                else if (fi.feature.includes('hum')) unit = '%';
                else if (fi.feature.includes('press')) unit = 'hPa';
                else if (fi.feature.includes('wind')) unit = 'm/s';
                return `${fi.feature} (${unit}) - ${(fi.importance * 100).toFixed(1)}% importance`;
            }).join(', ');
            
            const report = `
AIR QUALITY PREDICTION LAB REPORT
==================================
Date: ${new Date().toLocaleString()}
Student: [Your Name Here]
Instructor: Dr. P. Selvarengan

DATASET INFORMATION
-------------------
Total Samples: ${dataset.length}
After Preprocessing: ${processedData.length}
Target Variable: PM2.5 (¬µg/m¬≥)
Features Used: ${featuresUsed}
Preprocessing Steps: ${preprocessingSteps}

MODEL TRAINING CONFIGURATION
----------------------------
Train-Test Split: ${document.getElementById('trainSplit').value}% / ${100 - parseInt(document.getElementById('trainSplit').value)}%
Cross-Validation: ${document.getElementById('cvFolds').value}-fold
Models Trained: ${Object.keys(models).length}

MODEL PERFORMANCE RESULTS
-------------------------
Best Model: ${bestModel.name}
- Cross-validation R¬≤ Score: ${bestModel.cv_r2.toFixed(3)}
- Cross-validation RMSE: ${bestModel.cv_rmse.toFixed(1)} ¬µg/m¬≥
- Test R¬≤ Score: ${bestModel.test_r2.toFixed(3)}
- Test RMSE: ${bestModel.test_rmse.toFixed(1)} ¬µg/m¬≥

FEATURE IMPORTANCE ANALYSIS
---------------------------
Top 3 Most Important Features:
${bestModel.feature_importance.slice(0, 3).map((fi, idx) => 
    `${idx + 1}. ${fi.feature}: ${(fi.importance * 100).toFixed(1)}% importance`
).join('\n')}

OBSERVATIONS AND INTERPRETATION
-------------------------------
1. Model Performance Analysis:
   - The ${bestModel.name} achieved a cross-validation R¬≤ of ${bestModel.cv_r2.toFixed(3)}, 
     explaining approximately ${(bestModel.cv_r2 * 100).toFixed(1)}% of the variance in PM2.5 levels.
   - The RMSE of ${bestModel.cv_rmse.toFixed(1)} ¬µg/m¬≥ indicates the average prediction error.

2. Feature Impact:
   - ${topFeatures} were the most influential features in the model.
   - This suggests that these environmental factors have the strongest relationship with PM2.5 levels.

3. Model Comparison Insights:
   - ${bestModel.name} outperformed other models likely because ${getModelStrengthReason(bestModel.name)}.

4. Practical Implications:
   - The model can predict PM2.5 within ¬±${bestModel.cv_rmse.toFixed(1)} ¬µg/m¬≥ with ${(bestModel.cv_r2 * 100).toFixed(0)}% accuracy.
   - This level of accuracy is ${getAccuracyAssessment(bestModel.cv_r2)} for air quality monitoring.

LIMITATIONS AND RECOMMENDATIONS
------------------------------
1. Data Limitations:
   - Dataset size (${processedData.length} samples) may limit model generalizability.
   - Additional features like time of day, season, and traffic data could improve accuracy.

2. Model Limitations:
   - The model assumes ${getModelAssumptions(bestModel.name)}.
   - May not capture complex non-linear interactions beyond training data.

3. Recommendations for Improvement:
   - Collect more diverse data across different seasons and locations.
   - Consider adding weather forecast data and traffic information.
   - Experiment with ensemble methods or neural networks for potentially better performance.

LAB QUESTIONS ANSWERS
---------------------
[Answer the lab questions here based on your observations]

1. Which preprocessing steps improved model performance the most?
   [Your answer]

2. Which model performed best and why?
   [Your answer]

3. How does cross-validation score compare to simple train-test split?
   [Your answer]

4. Which features were most important in predicting PM2.5 levels?
   [Your answer]

5. What limitations does your best model have? What additional features would you add?
   [Your answer]

CONCLUSION
----------
This experiment successfully demonstrated the application of machine learning for 
air quality prediction. The ${bestModel.name} model showed promising results with 
${(bestModel.cv_r2 * 100).toFixed(1)}% accuracy in predicting PM2.5 levels based on 
environmental factors. The findings highlight the potential of ML in environmental 
monitoring and provide insights for developing more accurate air quality prediction systems.

---
Report Generated: ${new Date().toLocaleString()}
Virtual Lab Developed by: Dr. P. Selvarengan
            `;
            
            // Create download link
            const blob = new Blob([report], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `air_quality_lab_report_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Lab report generated and downloaded! Open the file to complete your answers.', 'success');
        }
        
        function getPreprocessingSummary() {
            const steps = [];
            if (document.getElementById('removeMissing').checked) steps.push('Remove missing values');
            if (document.getElementById('normalizeData').checked) steps.push('Normalize features (0-1 scaling)');
            if (document.getElementById('removeOutliers').checked) steps.push('Remove outliers (3 std dev)');
            if (document.getElementById('logTransform').checked) steps.push('Log transform PM2.5');
            return steps.join(', ') || 'None (raw data used)';
        }
        
        function getModelStrengthReason(modelName) {
            switch(modelName) {
                case 'Linear Regression':
                    return 'the relationships between features and PM2.5 are primarily linear';
                case 'Random Forest':
                    return 'it can capture complex non-linear relationships and interactions between features';
                case 'Decision Tree':
                    return 'it can capture specific threshold effects in the data';
                case 'SVR':
                    return 'it handles high-dimensional spaces well and is robust to outliers';
                default:
                    return 'it was better suited to the specific characteristics of this dataset';
            }
        }
        
        function getAccuracyAssessment(r2) {
            if (r2 > 0.8) return 'excellent';
            if (r2 > 0.6) return 'good';
            if (r2 > 0.4) return 'moderate';
            return 'fair';
        }
        
        function getModelAssumptions(modelName) {
            switch(modelName) {
                case 'Linear Regression':
                    return 'linear relationships between features and target, no multicollinearity';
                case 'Random Forest':
                    return 'features have predictive power and are not perfectly correlated';
                case 'Decision Tree':
                    return 'data can be split effectively using feature thresholds';
                case 'SVR':
                    return 'data can be separated by a hyperplane in transformed space';
                default:
                    return 'patterns in training data generalize to new data';
            }
        }
        
        function saveAllResults() {
            if (!bestModel) {
                showNotification('No results to save. Please train models first.', 'error');
                return;
            }
            
            const results = {
                datasetInfo: {
                    originalRows: dataset.length,
                    processedRows: processedData.length,
                    features: selectedFeatures,
                    target: target,
                    preprocessing: getPreprocessingSummary()
                },
                modelResults: {
                    bestModel: bestModel.name,
                    cv_r2: bestModel.cv_r2,
                    cv_rmse: bestModel.cv_rmse,
                    test_r2: bestModel.test_r2,
                    test_rmse: bestModel.test_rmse,
                    featureImportance: bestModel.feature_importance
                },
                configuration: {
                    trainSplit: document.getElementById('trainSplit').value,
                    cvFolds: document.getElementById('cvFolds').value,
                    timestamp: new Date().toLocaleString()
                },
                developer: "Dr. P. Selvarengan"
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const fileName = `air_quality_lab_results_${new Date().toISOString().slice(0,10)}.json`;
            
            const link = document.createElement('a');
            link.href = dataUri;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('All results saved as JSON file!', 'success');
        }
        
        function resetLab() {
            if (confirm("Reset the entire lab? This will clear all data, models, and results.")) {
                // Reset all variables
                dataset = [];
                processedData = [];
                features = [];
                selectedFeatures = [];
                models = {};
                bestModel = null;
                isDataLoaded = false;
                isPreprocessed = false;
                
                // Reset UI elements
                document.getElementById('dataPreview').style.display = 'none';
                document.getElementById('preprocessingSection').style.display = 'none';
                document.getElementById('dataInfo').style.display = 'none';
                document.getElementById('modelComparison').style.display = 'none';
                document.getElementById('testResults').style.display = 'none';
                document.getElementById('predictionControls').style.display = 'none';
                document.getElementById('noModelMessage').style.display = 'block';
                
                // Reset form elements
                document.getElementById('csvUpload').value = '';
                document.getElementById('removeMissing').checked = true;
                document.getElementById('normalizeData').checked = true;
                document.getElementById('removeOutliers').checked = false;
                document.getElementById('logTransform').checked = false;
                document.getElementById('modelLinear').checked = true;
                document.getElementById('modelRandomForest').checked = true;
                document.getElementById('modelDecisionTree').checked = false;
                document.getElementById('modelSVR').checked = false;
                document.getElementById('trainSplit').value = 80;
                document.getElementById('splitValue').textContent = '80%';
                document.getElementById('cvFolds').value = 5;
                
                // Reset charts
                if (charts.featureChart) {
                    charts.featureChart.data.datasets[0].data = [];
                    charts.featureChart.update();
                }
                if (charts.correlationChart) {
                    charts.correlationChart.data.labels = [];
                    charts.correlationChart.data.datasets[0].data = [];
                    charts.correlationChart.update();
                }
                if (charts.performanceChart) {
                    charts.performanceChart.data.labels = [];
                    charts.performanceChart.data.datasets[0].data = [];
                    charts.performanceChart.data.datasets[1].data = [];
                    charts.performanceChart.update();
                }
                
                // Clear prediction display
                document.getElementById('predictedPM25').textContent = '--';
                document.getElementById('pm25Indicator').textContent = '--';
                document.getElementById('pm25Indicator').className = 'pm25-indicator';
                document.getElementById('airQualityLabel').textContent = 'Click "Predict PM2.5" to see results';
                document.getElementById('confidenceInterval').innerHTML = '';
                document.getElementById('bestModelName').textContent = 'None selected';
                
                showNotification('Lab reset successfully! You can now start a new experiment.', 'info');
            }
        }
        
        // Helper functions
        function toggleLogTransform() {
            const isChecked = document.getElementById('logTransform').checked;
            if (isChecked) {
                showNotification('Note: Log transformation converts PM2.5 to log(PM2.5+1) to handle skewed distributions', 'info');
            }
        }
    </script>
</body>
</html>